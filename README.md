# Домашнє завдання до теми «IaC (Terraform)»

## Опис

Демонстрація створення інфраструктури AWS за допомогою Terraform за
допомогою модульної архітектури:

- збереження Terraform state в S3 із блокуванням за допомогою DynamoDB;
- побудова VPC;
- розгортання Elastic Container Registry (ECR).

---

## Структура проєкту

```
lesson-5/
│
├── main.tf                  # Головний файл для підключення модулів
├── backend.tf               # Налаштування бекенду для стейтів (S3 + DynamoDB)
├── outputs.tf               # Загальне виведення ресурсів
│
├── modules/                 # Каталог з усіма модулями
│   │
│   ├── s3-backend/          # Модуль для S3 та DynamoDB
│   │   ├── s3.tf            # Створення S3-бакета
│   │   ├── dynamodb.tf      # Створення DynamoDB
│   │   ├── variables.tf     # Змінні для S3
│   │   └── outputs.tf       # Виведення інформації про S3 та DynamoDB
│   │
│   ├── vpc/                 # Модуль для VPC
│   │   ├── vpc.tf           # Створення VPC, підмереж, Internet Gateway
│   │   ├── routes.tf        # Налаштування маршрутизації
│   │   ├── variables.tf     # Змінні для VPC
│   │   └── outputs.tf       # Виведення інформації про VPC
│   │
│   └── ecr/                 # Модуль для ECR
│       ├── ecr.tf           # Створення ECR репозиторію
│       ├── variables.tf     # Змінні для ECR
│       └── outputs.tf       # Виведення URL репозиторію ECR
│
└── README.md                # Документація проєкту
```


## Кроки виконання завдання

1. Створення основної структуру проєкту. У кореневій папці lesson-5 створено наступні файли:

- main.tf — підключення модулів.
- backend.tf — налаштування бекенду для збереження стейтів у S3.
- outputs.tf — загальні вихідні дані з усіх модулів.


2. Налаштування S3 для стейтів і DynamoDB. У модулі s3-backend маємо наступне:

- налаштування S3-бакет для стейт-файлів Terraform;
- увімкнення версіювання для збереження історії стейтів;
- налаштування таблиці DynamoDB для блокування стейтів;
- виведення URL S3-бакета та ім'я DynamoDB.


3. Побудова мережеві інфраструктури (VPC). У модулі vpc маємо наступне:

- створення VPC з CIDR блоком;
- додаваня 3 публічних підмереж та 3 приватних підмереж;
- створення Internet Gateway для публічних підмереж;
- створення NAT Gateway для приватних підмереж;
- налаштування маршрутизації через Route Tables.


4. Створення репозиторію ECR. У модулі ecr маємо насупне:

- створення ECR-репозиторію з автоматичним скануванням образів;
- налаштування політики доступу до репозиторію;
- виведення URL репозиторію.


## Команди для ініціалізації та запуску

```bash
# Ініціалізація
terraform init

# Перегляд змін інфраструктури
terraform plan

# Застосування інфраструктури
terraform apply

# Видалення інфраструктури
terraform destroy
```

## Налаштування віддаленого бекенду

Після початкового розгортання для активації віддаленого бекенду:

1. Розкоментуйте блок конфігурації бекенду в `backend.tf`.

2. Виконайте команду `terraform init` з параметром для повторного підключення бекенду:

```bash
terraform init -reconfigure
```

## Опис модулів

### Модуль `s3-backend`
Централізоване зберігання Terraform state.

- S3 бакет з шифруванням, версіюванням.
- DynamoDB таблиця для блокування стану.
---

### Модуль `vpc`
Побудова мережевої інфраструктури AWS.

- VPC з CIDR блоком `10.0.0.0/16`.
- 3 публічні та 3 приватні підмережі.
- Internet Gateway та NAT Gateway.
- Таблиці маршрутизації.

---

### Модуль `ecr`
Репозиторій для зберігання Docker-образів.

- ECR репозиторій з політиками життєвого циклу і автоматичним скануванням.
---

### Відновлення
1. Закоментуйте конфігурацію бекенду в `backend.tf`.
2. Виконайте `terraform init`.
3. Застосуйте конфігурацію `terraform apply`.
4. Розкоментуйте бекенд та виконайте `terraform init -reconfigure`.
---